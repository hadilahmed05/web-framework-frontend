
# Node.js with Angular
# Build a Node.js project that uses Angular.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript
trigger:
- main

pool:
  name: Default

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.10.12'
    addToPath: true

- task: CmdLine@2
  displayName: 'Install OWASP ZAP'
  inputs:
    script: |
      sudo apt-get update
      sudo apt-get install wget default-jre -y
      wget https://github.com/zaproxy/zaproxy/releases/download/v2.11.1/ZAP_2_11_1_unix.sh
      chmod +x ZAP_2_11_1_unix.sh
      ./ZAP_2_11_1_unix.sh -q # run silently

- task: CmdLine@2
  displayName: 'Run OWASP ZAP Scan'
  inputs:
    script: |
      ./ZAP_2_11_1/zap.sh -daemon -host 127.0.0.1 -port 8080 -config api.disablekey=true
      zap-cli quick-scan --self-contained --start-options '-config api.disablekey=true' http://172.213.180.82/

- task: PublishPipelineArtifact@1
  displayName: 'Publish OWASP ZAP Report'
  inputs:
    targetPath: 'ZAP_2_11_1/report.html'
    artifactName: 'zap-reports'
    publishLocation: 'pipeline'